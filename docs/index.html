<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="./Assets/JS/p5/p5.min.js"></script>
  <script src="./Assets/JS/sketch.js"></script>

  <title>CrystalCounter</title>
  <style>
    /* Reset styles */
    body,
    div,
    h2,
    button {
      margin: 0;
      padding: 0;
    }

    h2{
      font-size:60%;
      font-weight: bold;
      margin-bottom:3%;
    }
    p{
      font-size:40%;
    }

    body {
      font-family: Arial, sans-serif;
      font-size: 36px;
      background-color: #f2f2f2;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #fff;
      min-width: 800px;
      height: 300px;
    }

    /* Counter styles */
    .counter {
      position: relative;
      display: inline-block;
      margin: 0 2px;
      background-color: #fff;
      border-radius: 5px;
      /*box-shadow: 0 0 5px rgba(0, 0, 0, 0.5); */
      text-align: center;
      padding: 15px;
      vertical-align: top;
      max-width: 40%;
    }

    .counter:before {
      /*content: ""; */
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 5px;
      z-index: -1;
    }

    .counter div {
      font-weight: bold;
      font-style: oblique;
      text-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
      margin: 3px;
      margin-top: -5px;
    }

    .counter span {
      font-size: 128px;
      font-weight: bold;
      text-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
      margin-right: 10px;
      padding: 5px;
      display: inline-block;
      border-right: 1px solid #ccc;
      vertical-align: middle;
      transition: opacity 0.5s ease;
      /* イーズを追加 */
    }

    .counter button {
      background-color: rgba(76, 175, 80, 0.75);
      border: none;
      color: white;
      padding: 10px 10px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s;
      box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
      vertical-align: middle;
    }

    .counter button.minus {
      background-color: rgba(244, 67, 54, 0.5);
    }

    /* Background gradients */
    #counter1 {
      background-color: rgba(15, 178, 236, 1);
      background-image: repeating-conic-gradient(rgba(133, 214, 226, 0.75) 0deg, rgba(0, 139, 213, 0.75) 70deg, rgba(211, 255, 245, 0.75) 134deg);
      background: center no-repeat url(./Assets/SVG/BlueCrystal.svg);
      filter: drop-shadow(0 0 10px rgba(194, 248, 255, 1));
      background-blend-mode: screen;
    }

    #counter2 {
      background-color: rgba(236, 15, 100, 1);
      background: center no-repeat url(./Assets/SVG/RedCrystal.svg);
      /*background-image: repeating-conic-gradient(rgba(226, 133, 133, 1) 0deg, rgba(213, 0, 0, 1) 70deg, rgba(255, 227, 211, 1) 134deg);*/
      filter: drop-shadow(0 0 10px rgba(255, 202, 194, 1));
      background-blend-mode: screen;
    }

    /* Win/Lose text */
    .winlose:after {
      background-color: rgba(255, 255, 255, 0.5);
      filter: blur(5px);
    }

    /* Button block display */
    .btnblock {
      display: block;
    }

    /* Fade animation */
    @keyframes fadeInOut {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }

      100% {
        opacity: 1;
      }
    }

    .fadeInOut {
      animation: fadeInOut 0.3s ease;
    }

    /* ハンバーガーメニュー */
    .hamburger {
      display: block;
      cursor: pointer;
      z-index: 99;
      position: fixed;
      top: 20px;
      right: 20px;
      transition: transform 0.3s ease;
      /* アニメーション追加 */
    }

    .hamburger:hover {
      transform: scale(1.1);
      /* ホバー時の拡大 */
    }

    .hamburger__line {
      width: 30px;
      height: 4px;
      background-color: #333;
      margin: 5px 0;
      transition: background-color 0.3s ease;
    }

    .hamburger__line:hover {
      background-color: #555;
    }

    .menu {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 97;
  /* アニメーションの設定 */
  transition: backdrop-filter 1.0s ease, opacity 1.0s ease;
  backdrop-filter: blur(0px);
  opacity: 0%; /* メニューを最初は完全に透明にする */
}

.menu.open {
  display: block;
  /* アニメーションの設定 */
  backdrop-filter: blur(5px);
  opacity: 100%; /* メニューが開かれると完全に不透明にする */
}

    .menu__content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: left;
      /* メニューテキストを左揃えに */
      color: #fff;
      /* テキストカラーを白に */
    }
    
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -2;
    }

    #mySVG {
      z-index: -3;
      position: absolute;
      margin: auto;
      width: 100%;
      height: 100%;
      animation: rotateY 5s linear infinite;
      /* Y軸周りに5秒かけて回転し、無限に繰り返す */
      filter: blur(20px);
    }

    @keyframes rotateY {
      from {
        transform: rotateY(0deg);
      }

      to {
        transform: rotateY(360deg);
      }
    }


    .menuCategory{

      background:rgba(0, 0, 0, 0.5);
      border-radius:5px;
      margin-top: 3px;
      padding: 10px;
      user-select: none;
    }

    .menu-heading{
      font-size: 50%;
      font-weight: Bold;
    }

    label{
      font-size: 75%;
      cursor: pointer!important;
    }
    .modal {
    display: none; /* 初期状態では非表示 */
    position: fixed; /* 画面の上に固定 */
    z-index: 100; /* 最前面に表示 */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4); /* 背景を半透明に */
  }

  /* モーダルのコンテンツスタイル */
  .modal-content {
    background-color: rgba(0, 0, 0, 0.5);
    margin: auto; /* 画面中央に配置 */
    padding:5px 5px;
    width: 100%;
    height: 100%;
    overflow:scroll; /* モーダル外をスクロール可能に */
    max-width: 600px;
  }

  /* 閉じるボタンのスタイル */
  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  </style>
</head>

<body>
  <div id="myModal" class="modal">

    <!-- モーダルコンテンツ -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>■使い方</h2>
      <p>OBSでソース追加でブラウザソースとして使ってください。<br>その際のサイズは<b><u>幅800x高さ300</b></u>を推奨します。</p>
      <p>実際のカウント操作は、<b><u>「対話(操作)」</b></u>で出てくるウィンドウ内で操作してください。<br>StreamLabs OBSの場合は、キャンバス上に設置されたCrystalCounterを右クリックし<br>出てきたメニューの中にある <b><u>「インタラクト」</b></u>で同様に出てくるウィンドウで操作します。</p>

      <h2>■機能</h2>
      <p>右上のハンバーガーマークからいくつか機能があります。</p>
      <p>CounterMode：マッチングでの勝敗カウントする「Matching」モードと、カスタムでチームの勝利数をカウントする「Custom」モードを用意しました。</p>
      <p>ColorMode：色調を変えます。
      <p>Graphics：エフェクトの有無をしていします。Richはエフェクトを入れたもの。Simpleモードはカウント機能のみが表示されます。</p>
    </div>
  
  </div>

  <!-- ハンバーガーメニュー -->
  <div class="hamburger" onclick="toggleMenu()">
    <div class="hamburger__line"></div>
    <div class="hamburger__line"></div>
    <div class="hamburger__line"></div>
  </div>
  <div class="menu" id="menu" onclick="toggleMenu()">
    <div class="menu__content">
      <!-- 既存の大枠の2択メニュー -->
      <div class="menuCategory">
        <div class="menu-heading">Counter Mode</div>
      <label class="radio-label" for="matching">
      <input type="radio" id="matching" name="counterMode" value="matching" onchange="changeCounterText()" checked>Matching
      </label>
      <label class="radio-label" for="custom">
      <input type="radio" id="custom" name="counterMode" value="custom" onchange="changeCounterText()">Custom
      </label>
      </div>


      <!-- 新しい大枠の2択メニュー -->
      <div class="menuCategory">
        <div class="menu-heading">Color Mode</div>
      <label class="radio-label" for="White">
      <input type="radio" id="White" name="colorMode" value="White" onchange="changeColorText()" checked>White
      </label>
      <label class="radio-label" for="Black">
      <input type="radio" id="Black" name="colorMode" value="Black" onchange="changeColorText()">Black
      </label>
      <label class="radio-label" for="Mono">
        <input type="radio" id="Mono" name="colorMode" value="Mono" onchange="changeColorText()">Monochrome
        </label>
      </div>

      <div class="menuCategory">
        <div class="menu-heading">Graphics</div>
      <label class="radio-label" for="Rich">
      <input type="radio" id="Rich" name="Graphics" value="Rich" onchange="changeEffectsStatus()" checked>Rich
      </label>
      <label class="radio-label" for="Simple">
      <input type="radio" id="Simple" name="Graphics" value="Simple" onchange="changeEffectsStatus()">Simple
      </label>
      </div>
    </div>
  </div>


  <div class="counter" id="counter1">
    <div class="winlose">Win</div>
    <span>00</span>
    <button class="counterbtn" onclick="increaseCount(1)">＋</button>
    <button class="minus counterbtn" onclick="decreaseCount(1)">ー</button>
  </div>

  <object id="mySVG" type="image/svg+xml" data="./Assets/SVG/CenterCrystal.svg"></object>


  <div class="counter" id="counter2">
    <div class="winlose">Defeat</div>
    <span>00</span>
    <button class="counterbtn" onclick="increaseCount(2)">＋</button>
    <button class="minus counterbtn" onclick="decreaseCount(2)">ー</button>
  </div>



  <script>
    // ページ読み込み時に実行される関数
    window.onload = function() {
  // モーダルを表示する
  document.getElementById('myModal').style.display = "block";

  // モーダル自体がクリックされた時の処理
  document.getElementById('myModal').addEventListener('click', function() {
    // モーダルを非表示にする
    this.style.display = "none";
  });
};

    function toggleMenu() {
  var menu = document.getElementById("menu");
  if (menu.classList.contains("open")) {
    menu.classList.remove("open"); // メニューが開いている場合は閉じる
  } else {
    menu.classList.add("open"); // メニューが閉じている場合は開く
  }
}


    function changeCounterText() {
      var matchingCheckbox = document.getElementById("matching");
      var customCheckbox = document.getElementById("custom");
      var counterElement1 = document.getElementById('counter1');
      var counterElement2 = document.getElementById('counter2');

      if (matchingCheckbox.checked) {
        counterElement1.querySelector('.winlose').textContent = 'Win';
        counterElement2.querySelector('.winlose').textContent = 'Defeat';
      } else if (customCheckbox.checked) {
        counterElement1.querySelector('.winlose').textContent = 'Umbra';
        counterElement2.querySelector('.winlose').textContent = 'Astra';
      }
    }

    function changeColorText() {
  var WhiteCheckbox = document.getElementById("White");
  var BlackCheckbox = document.getElementById("Black");
  var MonoCheckbox = document.getElementById("Mono");
  var body = document.body;
  var btns = document.getElementsByClassName("counterbtn");
  var counterElement1 = document.getElementById('counter1');
  var counterElement2 = document.getElementById('counter2');

  if (WhiteCheckbox.checked) {
    body.style.color = "#fff";
    body.style.filter = "brightness(100%) contrast(100%)";
    counterElement1.style.color ="#fff";
    counterElement2.style.color ="#fff";
    for (var i = 0; i < btns.length; i++) {
      btns[i].style.color = "#fff";
    }
  } else if (BlackCheckbox.checked) {
    counterElement1.style.color ="#000";
    counterElement2.style.color ="#000";
    body.style.filter = "brightness(75%) contrast(150%)";
    for (var i = 0; i < btns.length; i++) {
      btns[i].style.color = "#000";
    }
  } else if (MonoCheckbox.checked) {
    counterElement1.style.color ="#000";
    counterElement2.style.color ="#fff";
    body.style.filter = "grayscale(100%) brightness(75%) contrast(200%)";
    for (var i = 0; i < btns.length; i++) {
      btns[i].style.color = "#fff";
    }
  }
}

function changeEffectsStatus() {
  var richEffectCheckbox = document.getElementById("Rich");
  var simpleEffectCheckbox = document.getElementById("Simple");
  var bigCrystal = document.getElementById('mySVG');
  var canvas = document.getElementById('canvas');

  if (richEffectCheckbox.checked) {
    bigCrystal.style.contentVisibility = "visible";
    canvas.style.contentVisibility = "visible";
  } else if (simpleEffectCheckbox.checked) {
    bigCrystal.style.contentVisibility = "hidden";
    canvas.style.contentVisibility = "hidden";
  }
}



    function increaseCount(counterNumber) {
      var counterElement = document.getElementById('counter' + counterNumber);
      var countSpan = counterElement.querySelector('span');
      var currentCount = parseInt(countSpan.textContent);

      if (isNaN(currentCount)) {
        currentCount = 0;
      }

      if (currentCount < 99) { // カウンターが99以下の場合のみ増加
        countSpan.textContent = ('0' + (currentCount + 1)).slice(-2);
        counterElement.classList.add('fadeInOut'); // アニメーションの追加
        setTimeout(function () {
          counterElement.classList.remove('fadeInOut'); // アニメーションの除去
        }, 300); // アニメーションの時間
      }
    }

    function decreaseCount(counterNumber) {
      var counterElement = document.getElementById('counter' + counterNumber);
      var countSpan = counterElement.querySelector('span');
      var currentCount = parseInt(countSpan.textContent);

      if (isNaN(currentCount)) {
        currentCount = 0;
      }

      if (currentCount > 0) { // カウンターが0より大きい場合のみ減少
        countSpan.textContent = ('0' + (currentCount - 1)).slice(-2);
        counterElement.classList.add('fadeInOut'); // アニメーションの追加
        setTimeout(function () {
          counterElement.classList.remove('fadeInOut'); // アニメーションの除去
        }, 300); // アニメーションの時間
      }
    }
  </script>
  <div id ="canvas"></div> <!-- p5.jsのキャンバスを指定して作成-->
</body>

</html>
